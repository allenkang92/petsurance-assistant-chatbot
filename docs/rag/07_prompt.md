## 프롬프트 (Prompt)

### 정의
프롬프트 단계는 **RAG 시스템의 6번째 단계**로, 리트리버에서 검색된 문서들을 바탕으로 LLM이 사용할 질문이나 명령을 생성하는 과정입니다.

```
문서 로드 → 분할 → 임베딩 → 벡터 스토어 → 리트리버 → 프롬프트 
```

### 프롬프트의 목적

| 목적 | 설명 |
|:---|:---|
| **정보 추출** | 검색된 문서에서 가장 적합한 정보를 추출 |
| **관점 통합** | 여러 문서의 다양한 관점을 하나로 통합 |
| **최적화된 답변** | 사용자 질문에 최적화된 답변 유도 |

> 프롬프트가 잘 구성되지 않으면 모델이 비효율적으로 작동하고, 사용자 요구에 부응하지 못하는 응답을 생성할 가능성이 큼

---

## 1. 프롬프트의 역할 구분

| 구분 | 역할 | 설명 | 예시 |
|:---|:---|:---|:---|
| **시스템 프롬프트** | 지침 및 페르소나 설정 | 대화 전반에 유지할 태도, 제약 사항, 응답 형식 정의. **전역적으로 적용** | • 10년차 펫보험 전문가<br>• 친절한 존댓말<br>• 의학적 조언 금지 |
| **사용자 프롬프트** | 구체적 작업 지시 | 해결할 질문이나 처리할 데이터 입력. **실제 수행할 작업** | • 약관 요약해줘<br>• 보장 여부 확인해줘 |

---

## 2. 프롬프트 템플릿 구조

### 3가지 핵심 요소

| 요소 | 설명 |
|:---|:---|
| **Instruction** | LLM에게 주는 지시 사항 |
| **Question** | 사용자가 입력한 질문 |
| **Context** | 리트리버에서 검색된 문서 (문맥) |

### 사용 이유
1.  **일관성 유지**: 항상 일정한 형식의 질문 생성
2.  **효율적 처리**: 변수만 바꿔 다양한 요청 처리
3.  **실수 방지**: 중요 지시 사항 누락 방지

---

## 3. 작성 팁 (Best Practices)

### 시스템 프롬프트
*   **페르소나 부여**: 명확한 역할 → 응답 전문성 향상
*   **제약 조건 명시**: "모르면 모른다고 해라" (Hallucination 방지)
*   **톤 앤 매너**: "간결하게", "쉽게 설명" 등

### 사용자 프롬프트
*   **명확한 지시**: "정리해줘", "비교해줘" 등 동사로 표현
*   **문맥 제공**: 배경 정보 함께 제공 (RAG 핵심)

---

## 4. 퓨샷 프롬프트 (Few-shot Prompting)

### 정의
복잡한 문맥이나 질문에 대해 **예시를 제공**하여 LLM이 패턴을 학습하게 하는 기법

| 기법 | 예시 개수 | 설명 |
|:---|:---:|:---|
| **Zero-shot** | 0개 | 예시 없이 질문만 |
| **One-shot** | 1개 | 하나의 답변 예시 제공 |
| **Few-shot** | 2개+ | 두 개 이상의 예시 제공 |

### 예제 선택기 (Example Selector)
*   모든 예시를 넣으면 **비용 증가** 문제
*   **질문과 유사한 예시만 선택**해서 프롬프트에 포함
*   불필요한 토큰 사용 감소

---

## 5. 코드 예시 (LangChain)

```python
from langchain_core.prompts import ChatPromptTemplate

# 프롬프트 템플릿 정의
prompt = ChatPromptTemplate.from_messages([
    # 시스템 프롬프트: 페르소나 및 제약 사항
    ("system", """당신은 10년 경력의 펫보험 전문 상담사입니다.
복잡한 보험 약관을 고객이 이해하기 쉬운 언어로 풀어서 설명해야 합니다.
확실하지 않은 정보는 답하지 마세요.

[참고 문서]
{context}"""),
    
    # 사용자 프롬프트: 질문
    ("user", "{question}")
])

# 체인 연결 및 실행
chain = prompt | model
response = chain.invoke({
    "context": "검색된 약관 내용...",
    "question": "노령견도 펫보험 가입이 가능한가요?"
})
print(response.content)
```

---

## 

```
┌─────────────────────────────────────────────┐
│           프롬프트 템플릿 구조               │
├─────────────────────────────────────────────┤
│  [System] 페르소나 + 제약 조건              │
│  [Context] 리트리버 검색 문서               │
│  [Question] 사용자 질문                     │
└─────────────────────────────────────────────┘
                    │
                    ▼
               LLM 답변 생성
```

| 기법 | 언제 사용? |
|:---|:---|
| **기본 템플릿** | 일반적인 Q&A |
| **퓨샷** | 복잡한 문맥, 특정 형식 필요 시 |
| **예제 선택기** | 비용 절감 + 관련 예시만 선택 |